<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0" />
        <{include file = 'headMeta.html'}>

        <title>为偶-手机登录</title>

        <!--新 Bootstrap 核心 CSS 文件--> 
        <link rel="stylesheet" href="//cdn.bootcss.com/bootstrap/3.3.5/css/bootstrap.min.css" />
        <!--可选的Bootstrap主题文件（一般不用引入）--> 
        <link rel="stylesheet" href="//cdn.bootcss.com/bootstrap/3.3.5/css/bootstrap-theme.min.css" />

        <!--jQuery文件。务必在bootstrap.min.js 之前引入--> 
        <script src="//cdn.bootcss.com/jquery/1.11.3/jquery.min.js"></script>
        <!--最新的 Bootstrap 核心 JavaScript 文件--> 
        <script src="//cdn.bootcss.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>

        <!-- jquery 表单验证-->
        <script src="//cdn.bootcss.com/jquery-validate/1.15.0/jquery.validate.min.js"></script>
        <script type="text/javascript" src="/js/libs/jquery.form.min.js"></script>

        <script type="text/javascript" src="/js/m/country.js"></script>

        <link rel="stylesheet" type="text/css" href="/css/m/global.css" />
        <link rel="stylesheet" type="text/css" href="/css/m/style.css" />

        <link rel="stylesheet" type="text/css" href="/css/m/login.css" />
        <link rel="stylesheet" type="text/css" href="/css/m/common.css" />
    </head>
    <body>
        <div class="wrap">
            <div class="header">
                <a href="/" class="logo"><img height="50" src="/images/logo.png" alt=""/></a>
            </div>
            <div class="login-box">
                <form name="loginForm" id="loginForm">
                    <div class="form-group col-xs-12">
                        <div class="country" id="countryList">
                            <div class="country-code" id="countryCode">+86</div>
                            <div class="country-list">
                                <div class="country-search"><input type="text" value="" id="countrySearchInput"/></div>
                                <{include file = 'countryCode_zh.html'}>
                            </div>
                        </div>
                        <input type="text" name="countryCode" value="" id="countryCodeInput" hidden='1' readonly='true'/>
                    </div>

                    <div class="form-group col-xs-12">
                        <input type="text" class="form-control" id="phone" name="phone" placeholder="手机号">
                    </div>
                    <div class="form-group col-xs-12 extra">
                        或使用<a href="/login/email">邮箱登录</a>
                    </div>


                    <div class="form-group col-xs-12">
                        <input type="password" class="form-control" id="password" name="password" placeholder="密码">
                    </div>

                    <div class="form-group col-xs-12">
                        <button type="submit" class="btn btn-login btn-lg btn-block">登&nbsp;&nbsp;录</button>
                    </div>

                </form>
                <ul>
                    <{include file = 'snsLogin.html'}>
                </ul>
                <div class="tip">
                    没有帐户？<a href="/signup">马上注册</a>
                </div>

            </div>

        </div>

        <script type="text/javascript">
            $(document).ready(function () {

                $("#loginForm").submit(function () {
                    var ajax_option = {
                        url: "/login/login", //默认是form action
                        type: "post",
                        data: {"type": 1},
                        dataType: "json",
                        beforeSerialize: function () {
//                            alert("表单数据序列化前执行的操作！");
                            //$("#txt2").val("java");//如：改变元素的值
                            $("#countryCodeInput").val($("#countryCode").text());
                        },
                        beforeSubmit: function () {
                            return $("#loginForm").valid();
                        },
                        success: function (resp) {//表单提交成功回调函数
                            if (resp.state === 0) {
                                var href = "/user";
                                if (resp.data.callbackUrl && resp.data.callbackUrl !== "") {
                                    href = resp.data.callbackUrl;
                                }
                                location.href = href;//location.href实现客户端页面的跳转
                            } else if (resp.state === 107) {
                                alert("账号或密码错误");
//                                $("#error-msg-login").text("账号或密码错误");
//                                $("#error-msg-login").addClass("show");
                            } else if (resp.state === 103) {
                                alert("输入信息有误，请重新输入！");
                            } else {
                                alert("服务异常，请稍后再试！");
                            }
                        },
                        error: function (err) {
//                        alert("表单提交异常！" + err.msg);
                        }
                    };
                    $('#loginForm').ajaxSubmit(ajax_option);
                    return false;
                });

                $('#loginForm').validate({
                    errorElement: 'span',
                    errorClass: 'help-block',
                    focusInvalid: false,
                    rules: {
                        phone: {
                            required: true,
                            number: true
                        },
                        password: {
                            required: true
                        }
                    },
                    messages: {
                        phone: {
                            required: "请输入手机号",
                            number: "手机号格式错误"
                        },
                        password: {
                            required: "请输入密码"
                        }

                    },
                    highlight: function (element) {
                        $(element).closest('.form-group').addClass('has-error');
                    },
                    success: function (label) {
                        label.closest('.form-group').removeClass('has-error');
                        label.remove();
                    },
                    errorPlacement: function (error, element) {
                        element.parent('div').append(error);
                    },
                    submitHandler: function (form) {
                        //            form.submit();
                    }

                });
            });

        </script>
    </body>
</html>