---
title: 豆瓣电影top250数据爬取
date: 2019-08-10 18:19:03
tags:
    - Go
    - 爬虫
categories:
    - Golang
---

###### 声明：一下内容仅供技术学习

简述：爬取豆瓣电影 `top 250` 的基础信息，包括电影🎬名，评分，评价人数，电影链接。
<!--more-->


```golang
package main

import (
    "fmt"
    "strconv"
    "net/http"
    "io"
    "regexp"
    "os"
)

func main() {
    var start int //起始页
    var end int   //结束页
    fmt.Print("请输入爬取的起始页:")
    fmt.Scanln(&start)
    fmt.Print("请输入爬取的结束页:")
    fmt.Scanln(&end)
    toWorking(start, end)
}

func toWorking(start, end int) {
    fmt.Printf("起始结束页是%d : %d\n", start, end)

    pageChan := make(chan int)
    for i := start; i <= end; i++ {
        go SpiderDoubanPage(i, pageChan)
    }

    for i := start; i <= end; i++ {
        //开启协程
        fmt.Printf("第 %d 页 爬取完成\n", <-pageChan)
    }
}

func SpiderDoubanPage(i int, pageChan chan int) {
    //https://movie.douban.com/top250?start=0&filter=
    //https://movie.douban.com/top250?start=25&filter=
    //https://movie.douban.com/top250?start=50&filter=
    url := "https://movie.douban.com/top250?start=" + strconv.Itoa((i-1)*25)

    //爬取url页面内容【横向爬取】
    result, err := httpGetDoubanUrlContent(url)
    if err != nil {
        fmt.Println("err message：", err)
        return
    }

    //fmt.Println(result)
    //使用正则表达式解析内容---电影名称
    film_pat := regexp.MustCompile(`width="100" alt="(.*?)"`)
    FilmNames := film_pat.FindAllStringSubmatch(result, -1)

    //使用正则表达式解析内容---电影分数
    score_pat := regexp.MustCompile(`v:average">(?s:(.*?))<`)
    filmScores := score_pat.FindAllStringSubmatch(result, -1)

    //使用正则表达式解析内容---评价人数
    people_pat := regexp.MustCompile(`<span>(?s:(\d*?))人评价</span>`)
    peopleNum := people_pat.FindAllStringSubmatch(result, -1)

    //使用正则表达式解析内容---电影详情页url
    film_url_pat := regexp.MustCompile(`<a href="(.*?)" class="">`)
    filmUrls := film_url_pat.FindAllStringSubmatch(result, -1)

    //使用正则表达式解析内容---电影序号
    film_order_pat := regexp.MustCompile(`<em class="">(\d*)</em>`)
    filmOrders := film_order_pat.FindAllStringSubmatch(result, -1)

    saveToFile(i, filmOrders, FilmNames, filmScores, peopleNum, filmUrls)

    pageChan <- i

}

func httpGetDoubanUrlContent(url string) (result string, err error) {
    resp, err1 := http.Get(url)
    if err1 != nil {
        err = err1
        return
    }

    defer resp.Body.Close()

    buffer := make([]byte, 8192)
    for {
        n, err2 := resp.Body.Read(buffer)
        if n == 0 {
            fmt.Println("读取网页完成")
            break
        }

        if err2 != nil && err2 != io.EOF {
            err = err2
            return
        }
        result += string(buffer[:n])
    }
    return
}

func saveToFile(idx int, filmOrders, filmNames, filmScores, peopleNum, filmUrls [][]string) {
    //将读取到的数据存储存储为文件
    dir, _ := os.Getwd()
    filePath := dir + "douban_top_" + strconv.Itoa(idx) + ".txt"

    file, err := os.Create(filePath)
    if err != err {
        fmt.Println("os Create err：", err.Error())
        return
    }

    defer file.Close() //保存好一个文件就关闭一个文件

    file.WriteString(
        "序号" +
            "\t" + "电影名称" +
            "\t" + "电影评分" +
            "\t" + "评价人数" +
            "\t" + "链接地址" +
            "\n")
    for i := 0; i < len(filmNames); i++ {
        file.WriteString(
            filmOrders[i][1] +
                "\t" + filmNames[i][1] +
                "\t" + filmScores[i][1] +
                "\t" + peopleNum[i][1] +
                "\t" + filmUrls[i][1] +
                "\n")
    }
}


```

##### 爬取样本如下 `eg:crawlerdouban_top_1.txt`
```txt
序号    电影名称    电影评分    评价人数    链接地址
1    肖申克的救赎    9.7    1535695    https://movie.douban.com/subject/1292052/
2    霸王别姬    9.6    1136522    https://movie.douban.com/subject/1291546/
3    这个杀手不太冷    9.4    1388824    https://movie.douban.com/subject/1295644/
4    阿甘正传    9.4    1199279    https://movie.douban.com/subject/1292720/
5    美丽人生    9.5    702825    https://movie.douban.com/subject/1292063/
6    千与千寻    9.3    1231099    https://movie.douban.com/subject/1291561/
7    泰坦尼克号    9.4    1140842    https://movie.douban.com/subject/1292722/
8    辛德勒的名单    9.5    623915    https://movie.douban.com/subject/1295124/
9    盗梦空间    9.3    1189561    https://movie.douban.com/subject/3541415/
10    忠犬八公的故事    9.3    795328    https://movie.douban.com/subject/3011091/
11    机器人总动员    9.3    788458    https://movie.douban.com/subject/2131459/
12    三傻大闹宝莱坞    9.2    1075170    https://movie.douban.com/subject/3793023/
13    放牛班的春天    9.3    748223    https://movie.douban.com/subject/1291549/
14    海上钢琴师    9.2    872907    https://movie.douban.com/subject/1292001/
15    楚门的世界    9.2    832134    https://movie.douban.com/subject/1292064/
16    大话西游之大圣娶亲    9.2    835440    https://movie.douban.com/subject/1292213/
17    星际穿越    9.3    854952    https://movie.douban.com/subject/1889243/
18    龙猫    9.2    739493    https://movie.douban.com/subject/1291560/
19    熔炉    9.3    492270    https://movie.douban.com/subject/5912992/
20    教父    9.3    536821    https://movie.douban.com/subject/1291841/
21    无间道    9.2    686756    https://movie.douban.com/subject/1307914/
22    疯狂动物城    9.2    961506    https://movie.douban.com/subject/25662329/
23    当幸福来敲门    9.1    870538    https://movie.douban.com/subject/1849031/
24    怦然心动    9.0    971877    https://movie.douban.com/subject/3319755/
25    触不可及    9.2    569502    https://movie.douban.com/subject/6786002/

```